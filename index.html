<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Chat v2.1</title>
    <!-- Стили остаются без изменений как в предыдущей версии -->
    <style>
        /* Все стили из предыдущего кода сохраняются */
    </style>
</head>
<body>
    <div class="scanline"></div>
    
    <div class="counters">
        TOTAL: <span id="totalVisits">0</span><br>
        ONLINE: <span id="onlineNow">0</span>
    </div>

    <div id="chat-container">
        <div id="messages"></div>
        <form id="message-form">
            <input type="text" id="message-input" placeholder="ВВЕДИТЕ СООБЩЕНИЕ...">
            <button type="submit">ОТПРАВИТЬ</button>
        </form>
    </div>

    <script>
        (function(){
            const secret = atob('TWsxeA=='); // Декодирование подписи
            
            // Инициализация хранилища
            let messages = JSON.parse(localStorage.getItem('m')) || [];
            let total = localStorage.getItem('t') || 0;
            let online = localStorage.getItem('o') || 0;

            // Система команд
            function processCommand(text) {
                const command = text.replace(`[${secret}] `, '').trim();
                
                // Удалить все сообщения
                if(command.toLowerCase() === 'удалить') {
                    messages = [];
                    localStorage.setItem('m', JSON.stringify(messages));
                    return true;
                }
                
                // Удалить по дате
                if(command.toLowerCase().startsWith('удалить ')) {
                    const targetDate = command.slice(8).trim();
                    const timestamp = Date.parse(targetDate);
                    
                    if(!isNaN(timestamp)) {
                        messages = messages.filter(msg => {
                            const msgDate = new Date(msg.time).setHours(0,0,0,0);
                            const target = new Date(timestamp).setHours(0,0,0,0);
                            return msgDate !== target;
                        });
                        localStorage.setItem('m', JSON.stringify(messages));
                        return true;
                    }
                }
                return false;
            }

            // Обработчик сообщений
            document.getElementById('message-form').addEventListener('submit', e => {
                e.preventDefault();
                let text = document.getElementById('message-input').value.trim();
                
                if(text) {
                    // Обработка подписи
                    let isCommand = false;
                    if(text.endsWith('#m')) {
                        text = text.slice(0, -2).trim();
                        text = `[${secret}] ${text}`;
                        isCommand = text.startsWith(`[${secret}] удалить`);
                    }
                    
                    // Если это команда - выполняем и не сохраняем сообщение
                    if(isCommand && processCommand(text)) {
                        document.getElementById('message-input').value = '';
                        updateMessages();
                        return;
                    }
                    
                    // Сохранение обычного сообщения
                    messages.push({ text: text, time: Date.now() });
                    localStorage.setItem('m', JSON.stringify(messages));
                    document.getElementById('message-input').value = '';
                    updateMessages();
                }
            });

            // Остальной код (счётчики, обновление сообщений) остаётся без изменений
            // ... 
        })();
    </script>
</body>
</html>
